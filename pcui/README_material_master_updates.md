# 物料主数据模块更新说明

## 概述
本文档详细说明了物料主数据模块的所有改进和新增功能，包括弹窗选择、UI美化、默认值设置等。

## 主要功能改进

### 1. 分类字段弹窗选择功能
- **功能描述**: 在新增/修改物料主数据时，分类字段提供弹窗单选功能
- **数据来源**: 从物料分类模块获取数据
- **显示格式**: `category_code - category_name`
- **过滤条件**: 只显示 `is_active = "1"` 的启用分类
- **实现方式**: 使用 `MaterialCategorySelect` 组件

### 2. 单位字段弹窗选择功能
- **功能描述**: 在新增/修改物料主数据时，单位字段提供弹窗单选功能
- **数据来源**: 从单位模块获取数据
- **显示格式**: `unit_name`
- **过滤条件**: 只显示 `status = "0"` 的正常状态单位
- **实现方式**: 使用 `UnitSelect` 组件

### 3. 搜索条件分类字段弹窗选择
- **功能描述**: 在主页面搜索条件中，分类字段也提供弹窗选择功能
- **数据来源**: 从物料分类模块获取数据
- **过滤条件**: 只显示 `is_active = "1"` 的启用分类
- **实现方式**: 复用 `MaterialCategorySelect` 组件，设置 `:only-active="true"`

### 4. 默认值设置
- **是否采购件**: 默认值 `"0"`
- **是否制造件**: 默认值 `"0"`
- **是否销售件**: 默认值 `"0"`
- **是否库存件**: 默认值 `"0"`
- **是否启用**: 默认值 `"1"`

### 5. UI美化改进
- **对话框宽度**: 从 `500px` 调整为 `90%`
- **Tab页布局**: 使用 `el-tabs` 分为三个标签页：
  - 基本信息 (basic)
  - 库存配置 (inventory)
  - 业务属性 (business)
- **表单布局**: 使用 `el-row` 和 `el-col` 实现两列布局
- **输入框美化**: 
  - 添加 `prefix-icon` 图标
  - 分类和单位字段提供"选择"和"清除"按钮
  - 使用 `el-input-number` 替代数字输入框
- **文本域**: 物料规格和备注字段使用 `type="textarea"`

## 技术实现细节

### 组件结构
```
MasterMaterial (主页面)
├── MaterialCategorySelect (分类选择弹窗)
│   ├── 搜索用: :only-active="true"
│   └── 表单用: :only-active="true"
└── UnitSelect (单位选择弹窗)
```

### 数据流
1. **弹窗显示**: 调用 `showCategorySelect()` 或 `showUnitSelect()`
2. **数据选择**: 用户选择后触发 `@select` 事件
3. **数据处理**: `handleCategorySelect()` 或 `handleUnitSelect()` 处理选择结果
4. **显示更新**: 更新对应的显示字段和表单数据

### 错误处理
- **API调用失败**: 添加 `.catch()` 处理，设置默认值
- **数据验证**: 确保 `total` 字段始终为数字类型
- **空值处理**: 使用 `|| []` 和 `|| 0` 提供默认值

## 文件修改清单

### 前端文件
1. **`pcui/src/views/erp/masterMaterial/index.vue`**
   - 主页面布局和功能实现
   - 弹窗选择逻辑
   - UI美化改进

2. **`pcui/src/components/MaterialCategorySelect.vue`**
   - 物料分类选择弹窗组件
   - 支持 `onlyActive` 属性控制过滤条件
   - 错误处理和默认值设置

3. **`pcui/src/components/UnitSelect.vue`**
   - 单位选择弹窗组件
   - 错误处理和默认值设置

### 后端文件
- 无需修改，使用现有的API接口

## 使用方法

### 新增物料主数据
1. 点击"新增"按钮
2. 在"基本信息"标签页中：
   - 点击分类字段的"选择"按钮，选择物料分类
   - 点击单位字段的"选择"按钮，选择计量单位
3. 填写其他必要信息
4. 点击"确定"保存

### 搜索物料主数据
1. 在搜索条件中点击分类字段
2. 弹窗中选择要搜索的分类
3. 点击"搜索"按钮执行查询

### 修改物料主数据
1. 点击"修改"按钮
2. 在弹窗中修改相关信息
3. 分类和单位字段可以重新选择
4. 点击"确定"保存修改

## 注意事项

1. **分类选择限制**: 只能选择启用的分类 (`is_active = "1"`)
2. **单位选择限制**: 只能选择正常状态的单位 (`status = "0"`)
3. **默认值**: 新增时业务属性字段会自动设置默认值
4. **数据验证**: 必填字段会在提交时进行验证

## 兼容性

- 支持现有的物料主数据记录
- 不影响其他模块的功能
- 向后兼容，可以正常编辑历史数据

## 更新日志

- **2024-01-XX**: 初始版本，实现基本弹窗选择功能
- **2024-01-XX**: 添加搜索条件分类选择功能
- **2024-01-XX**: 实现UI美化，使用Tab页布局
- **2024-01-XX**: 修复控制台错误，添加错误处理
- **2024-01-XX**: 完善文档说明

## 联系方式

如有问题或建议，请联系开发团队。
